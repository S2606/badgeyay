matrix:
  include:
  - language: python3

    sudo: required

    addons:
      firefox: 55.0
      apt:
          packages:
             - python-dev

     python:
       - 3.5
     cache:
        directories:
          - $HOME/.pip-cache/

    before_install:
    - sudo apt-get -qq update
    - sudo apt-get -y install python3-pip
    - sudo apt-get install python-virtualenv
    - wget https://github.com/mozilla/geckodriver/releases/download/v0.19.0/geckodriver-v0.19.0-linux64.tar.gz
    - mkdir geckodriver
    - tar -xzf geckodriver-v0.19.0-linux64.tar.gz -C geckodriver
    - export PATH=$PATH:$PWD/geckodriver

    install:
    - virtualenv  -p python3 ../flask_env
    - source ../flask_env/bin/activate
    - pip3 install -r backend/app/requirements.txt --cache-dir $HOME/.pip-cache

    before_script:
    - export DISPLAY=:99.0
    - sh -e /etc/init.d/xvfb start
    - sleep 3

    script:
    - python backend/app/main.py >> log.txt 2>&1  &
    - nosetests backend/app/tests/test_api.py -v --with-coverage
    - python3 -m pyflakes .
    - cd v1/app/cli
    - python setup.py install
    - cd ..
    - badgeyay -i app/static/uploads/yellow_futuristic.png -n sample/businesspass.png.csv

    after_success:
    - bash <(curl -s https://codecov.io/bash)

  - language: node_js
    node_js:
      - "6"

    sudo: false
    dist: trusty

    addons:
      chrome: stable

    cache:
      directories:
        - $HOME/.npm

    env:
      global:
      # See https://git.io/vdao3 for details.
        - JOBS=1

    before_install:
      - npm config set spin false

    script:
      - npm run lint:js
      - npm test
